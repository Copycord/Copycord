<!doctype html>
<html lang="en" class="boot">

<head>
  <meta charset="utf-8" />
  <title>Copycord</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ request.url_for('static', path='assets/main.css') }}?v={{ version }}">
  <link rel="icon" type="image/png" href="/static/logo.png">
</head>

<body>
  <header class="site-header" role="banner">
    <button id="menu-toggle" class="menu-btn" aria-haspopup="true" aria-expanded="false" aria-controls="side-menu"
      aria-label="Open menu">
      <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </button>

    <div class="header-left">
      <img src="/static/logo.png" alt="" aria-hidden="true" class="header-logo" draggable="false" />
      <h1>Copycord</h1>
    </div>
  </header>

  <div id="menu-backdrop" class="menu-backdrop" hidden></div>
  <aside id="side-menu" class="side-menu" aria-hidden="true" aria-label="Site menu">
    <div class="side-menu-header"></div>

    <nav class="side-menu-body">
      <ul class="menu-list">
        <li><a class="menu-item" href="/" rel="noopener">Configuration</a></li>
        <li><a class="menu-item" href="/channels" rel="noopener">Channels</a></li>
        <li><a class="menu-item is-active" href="/guilds" rel="noopener">Guilds</a></li>
      </ul>
    </nav>
  </aside>

  <div class="container">
    <div class="card">
      <section class="widget">
        <header>
          <h2>Bots</h2>
        </header>
        <div class="runtime-container">
          <table class="runtime-table">
            <thead>
              <tr>
                <th>Component</th>
                <th>State</th>
                <th>Uptime</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="runtime-body">
              <tr>
                <td>Server</td>
                <td><span id="server-state" class="badge">-</span></td>
                <td id="server-uptime"></td>
                <td id="server-status"></td>
              </tr>
              <tr>
                <td>Client</td>
                <td><span id="client-state" class="badge">-</span></td>
                <td id="client-uptime"></td>
                <td id="client-status"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <div class="btns">
        <form method="post" action="/start" id="toggle-form">
          <button class="btn btn-ghost" id="toggle-btn">Start</button>
        </form>

        <span class="flex-spacer"></span>

        <button type="button" class="btn btn-ghost push-right" data-log="server">View server logs</button>
        <button type="button" class="btn btn-ghost" data-log="client">View client logs</button>
        <form method="post" action="/logs/clear"><button class="btn btn-ghost">Clear all logs</button></form>
      </div>
    </div>

    <div class="card">
      <h3>Configuration</h3>

      {% set FIELD_TIPS = {
      "SERVER_TOKEN": "Bot token from the Discord Developer Portal.",
      "CLIENT_TOKEN": "Discord account token.",
      "DELETE_ROLES": "When enabled, remove any roles in the clone that do not exist in the host.",
      "MIRROR_ROLE_PERMISSIONS": "When enabled, mirror role permissions from the host to the clone.",
      "COMMAND_USERS": "User IDs authorized to run admin commands.",
      "HOST_GUILD_ID": "ID of the host (source) server to mirror.",
      "CLONE_GUILD_ID": "ID of your destination (clone) server.",
      "DELETE_THREADS": "When enabled, delete in the clone any threads that were removed in the host.",
      "DELETE_CHANNELS": "When enabled, delete in the clone any channels that were removed in the host.",
      "CLONE_EMOJI": "When enabled, synchronize emojis from the host to the clone.",
      "CLONE_STICKER": "When enabled, synchronize stickers from the host to the clone.",
      "CLONE_ROLES": "When enabled, synchronize roles from the host to the clone.",
      "ENABLE_CLONING": "Master switch to enable or disable cloning.",
      } %}

      <form method="post" action="/save" id="cfg-form" novalidate>
        <div class="grid">
          {% for k in text_keys if k != 'COMMAND_USERS' %}
          {% set is_token = 'TOKEN' in k %}
          {% set is_id = k.endswith('_ID') %}
          <div class="field">
            <label for="{{ k }}" class="has-tip">
              <span class="label-text">{{ k }}</span>
              {% if FIELD_TIPS.get(k) %}
              <button type="button" class="info-dot" aria-label="What is {{ k }}?"
                aria-describedby="tip-{{ k }}"></button>
              <span id="tip-{{ k }}" role="tooltip" class="tip-bubble">
                {{ FIELD_TIPS[k] }}
              </span>
              {% endif %}
            </label>

            <input type="{{ 'password' if is_token else 'text' }}" id="{{ k }}" name="{{ k }}"
              value="{{ env.get(k,'') }}" {% if is_id %} inputmode="numeric" {% endif %} {% if is_token %}
              autocomplete="off" spellcheck="false" {% endif %} />
          </div>
          {% endfor %}

          <div class="field field-chips">
            <label for="cmd_users_input" class="has-tip">
              <span class="label-text">COMMAND_USERS</span>
              {% if FIELD_TIPS.get('COMMAND_USERS') %}
              <button type="button" class="info-dot" aria-label="What is COMMAND_USERS?"
                aria-describedby="tip-COMMAND_USERS"></button>
              <span id="tip-COMMAND_USERS" role="tooltip" class="tip-bubble">
                {{ FIELD_TIPS['COMMAND_USERS'] }}
              </span>
              {% endif %}
            </label>

            <div class="chips chips-compact" data-chips="cmd_users">
              <input id="cmd_users_input" class="chip-input" type="text" inputmode="numeric" />
            </div>
            <input type="hidden" name="COMMAND_USERS" id="COMMAND_USERS" value="{{ env.get('COMMAND_USERS','') }}">
          </div>

          {% for k in bool_keys %}
          <div class="field">
            <label for="{{ k }}" class="has-tip">
              <span class="label-text">{{ k }}</span>
              {% if FIELD_TIPS.get(k) %}
              <button type="button" class="info-dot" aria-label="What is {{ k }}?"
                aria-describedby="tip-{{ k }}"></button>
              <span id="tip-{{ k }}" role="tooltip" class="tip-bubble">
                {{ FIELD_TIPS[k] }}
              </span>
              {% endif %}
            </label>
            <div class="select">
              {% set val = env.get(k, 'True' if k!='MIRROR_ROLE_PERMISSIONS' else 'False') %}
              <select id="{{ k }}" name="{{ k }}">
                <option value="True" {{ 'selected' if val|string|lower in ['true','1','yes','on'] else '' }}>True
                </option>
                <option value="False" {{ 'selected' if val|string|lower in ['false','0','no','off'] else '' }}>False
                </option>
              </select>
            </div>
          </div>
          {% endfor %}

          <div class="field">
            <label for="LOG_LEVEL" class="has-tip">
              <span class="label-text">LOG_LEVEL</span>
              <button type="button" class="info-dot" aria-label="What is LOG_LEVEL?"
                aria-describedby="tip-LOG_LEVEL"></button>
              <span id="tip-LOG_LEVEL" role="tooltip" class="tip-bubble">
                INFO for normal use, DEBUG for troubleshooting.
              </span>
            </label>
            <div class="select">
              <select id="LOG_LEVEL" name="LOG_LEVEL">
                <option value="INFO" {{ 'selected' if (log_level|upper)=='INFO' else '' }}>INFO</option>
                <option value="DEBUG" {{ 'selected' if (log_level|upper)=='DEBUG' else '' }}>DEBUG</option>
              </select>
            </div>
          </div>

          <div class="btns">
            <button class="btn btn-ghost" type="submit">Save</button>
            <button type="button" class="btn btn-ghost" id="btn-cancel" hidden>Cancel</button>
          </div>
        </div>
      </form>
    </div>

    {# Tips for the Sync Filters fields #}
    {% set FILTER_TIPS = {
    "wl_categories": "Host category IDs to whitelist. Only these categories (and their channels) are cloned.",
    "wl_channels": "Host channel IDs to whitelist. Only these channels (and their linked categories) will be cloned.",
    "ex_categories": "Host category IDs to exclude from cloning.",
    "ex_channels": "Host channel IDs to exclude from cloning."
    } %}

    <div class="card" id="card-filters">
      <h3>Sync Filters</h3>
      <div class="card-body">

        <details class="info-details">
          <summary>Info</summary>
          <div class="info-content">
            <p><strong>Whitelist (allow-list):</strong> If <em>any</em> IDs are listed, <em>only</em> those
              categories/channels are cloned. Leave <em>both</em> whitelist lists empty to disable whitelist mode.</p>
            <p><strong>Excluded (deny-list):</strong> Anything listed here is dropped.</p>
            <p><strong>Precedence:</strong></p>
            <ol>
              <li><strong>Channel whitelist</strong> &gt; channel exclude</li>
              <li><strong>Channel exclude</strong> &gt; category whitelist</li>
              <li><strong>Category whitelist</strong> &gt; category exclude</li>
            </ol>
            <p><strong>IDs:</strong> Use IDs from the <em>host (source) guild</em>, not the clone.</p>
          </div>
        </details>

        <form id="form-filters" action="/filters/save" method="post">
          <div class="filters-grid">
            <div class="filters-col">
              <h4>Whitelist (allow-list)</h4>

              <div class="chips-field" style="position:relative">
                <label class="chips-label has-tip" for="wl_categories_input">
                  <span class="label-text">Categories to allow</span>
                  <button type="button" class="info-dot" aria-label="What is Categories to allow?"
                    aria-describedby="tip-wl_categories"></button>
                  <span id="tip-wl_categories" role="tooltip" class="tip-bubble">
                    {{ FILTER_TIPS['wl_categories'] }}
                  </span>
                </label>
                <div class="chips chips-compact" data-chips="wl_categories">
                  <input id="wl_categories_input" class="chip-input" type="text" inputmode="numeric" />
                </div>
                <input type="hidden" name="wl_categories" id="wl_categories" value="">
              </div>

              <div class="chips-field" style="position:relative">
                <label class="chips-label has-tip" for="wl_channels_input">
                  <span class="label-text">Channels to allow</span>
                  <button type="button" class="info-dot" aria-label="What is Channels to allow?"
                    aria-describedby="tip-wl_channels"></button>
                  <span id="tip-wl_channels" role="tooltip" class="tip-bubble">
                    {{ FILTER_TIPS['wl_channels'] }}
                  </span>
                </label>
                <div class="chips chips-compact" data-chips="wl_channels">
                  <input id="wl_channels_input" class="chip-input" type="text" inputmode="numeric" />
                </div>
                <input type="hidden" name="wl_channels" id="wl_channels" value="">
              </div>
            </div>

            <div class="filters-col">
              <h4>Exclude (deny-list)</h4>

              <div class="chips-field" style="position:relative">
                <label class="chips-label has-tip" for="ex_categories_input">
                  <span class="label-text">Categories to drop</span>
                  <button type="button" class="info-dot" aria-label="What is Categories to drop?"
                    aria-describedby="tip-ex_categories"></button>
                  <span id="tip-ex_categories" role="tooltip" class="tip-bubble">
                    {{ FILTER_TIPS['ex_categories'] }}
                  </span>
                </label>
                <div class="chips chips-compact" data-chips="ex_categories">
                  <input id="ex_categories_input" class="chip-input" type="text" inputmode="numeric" />
                </div>
                <input type="hidden" name="ex_categories" id="ex_categories" value="">
              </div>

              <div class="chips-field" style="position:relative">
                <label class="chips-label has-tip" for="ex_channels_input">
                  <span class="label-text">Channels to drop</span>
                  <button type="button" class="info-dot" aria-label="What is Channels to drop?"
                    aria-describedby="tip-ex_channels"></button>
                  <span id="tip-ex_channels" role="tooltip" class="tip-bubble">
                    {{ FILTER_TIPS['ex_channels'] }}
                  </span>
                </label>
                <div class="chips chips-compact" data-chips="ex_channels">
                  <input id="ex_channels_input" class="chip-input" type="text" inputmode="numeric" />
                </div>
                <input type="hidden" name="ex_channels" id="ex_channels" value="">
              </div>
            </div>
          </div>

          <div class="btns mt-3">
            <button class="btn btn-ghost" type="submit">Save Filters</button>
            <button type="button" class="btn btn-ghost" id="btn-cancel-filters" hidden>Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="log-modal" class="modal" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="log-title">
        <div class="modal-header">
          <h4 id="log-title" class="modal-title">Logs</h4>
          <input id="log-search-input" class="log-search-input" type="text" placeholder="Search…"
            aria-label="Search logs" />
          <button type="button" id="log-close" class="icon-btn verify-close" aria-label="Close">✕</button>
        </div>
        <pre id="log-body" class="log-output"></pre>
      </div>
    </div>

    <div id="confirm-modal" class="modal" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
        <div class="modal-header">
          <h4 id="confirm-title" class="modal-title">Confirm</h4>
          <button type="button" id="confirm-close" class="icon-btn verify-close" aria-label="Close">✕</button>
        </div>
        <div class="p-4" id="confirm-body" style="padding:12px 16px; color:#e6e1ff;">
          Are you sure?
        </div>
        <div class="btns" style="padding: 0 16px 16px 16px;">
          <button type="button" id="confirm-cancel" class="btn btn-ghost">Cancel</button>
          <button type="button" id="confirm-okay" class="btn btn-ghost">Delete</button>
        </div>
      </div>
    </div>

    <div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="true"></div>

    <footer id="fixed-footer" role="contentinfo" aria-label="Site footer">
      <div class="footer-bar">
        <span class="footer-brand" aria-label="Copycord version {{ version or 'dev' }}">
          <span class="brand-name">Copycord</span>
          <span class="brand-sep" aria-hidden="true"></span>
          <bdi class="brand-version" id="footer-version">
            {% if version %}
            <a id="footer-version-link" href="https://github.com/Copycord/Copycord/releases/tag/{{ version }}"
              target="_blank" rel="noopener" class="footer-link"
              data-default-href="https://github.com/Copycord/Copycord/releases/tag/{{ version }}">
              {{ version }}
            </a>
            {% else %}
            <span id="footer-version-text">dev</span>
            {% endif %}
          </bdi>
        </span>

        <div class="footer-links" role="group" aria-label="Links">
          <a class="footer-link" href="https://github.com/Copycord/Copycord" target="_blank" rel="noopener"
            aria-label="GitHub">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path
                d="M12,2A10,10 0 0,0 2,12c0,4.42 2.87,8.16 6.84,9.49.5.09.68-.22.68-.48 0-.24-.01-.87-.01-1.71-2.78.6-3.37-1.34-3.37-1.34-.45-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.61.07-.61 1.01.07 1.54 1.04 1.54 1.04.9 1.53 2.36 1.09 2.94.83.09-.65.35-1.09.63-1.34-2.22-.25-4.56-1.11-4.56-4.95 0-1.09.39-1.98 1.03-2.68-.1-.25-.45-1.27.1-2.65 0 0 .84-.27 2.75 1.02A9.56 9.56 0 0 1 12 6.8c.85 0 1.71.11 2.51.33 1.9-1.29 2.74-1.02 2.74-1.02.55 1.38.2 2.4.1 2.65.64.7 1.03 1.59 1.03 2.68 0 3.85-2.34 4.7-4.57 4.95.36.31.68.92.68 1.85 0 1.34-.01 2.42-.01 2.75 0 .26.18.58.69.48A10 10 0 0 0 22 12 10 10 0 0 0 12 2Z" />
            </svg>
          </a>

          <a class="footer-link" href="https://discord.gg/ArFdqrJHBj" target="_blank" rel="noopener"
            aria-label="Join our Discord">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="20" height="20">
              <path
                d="M20.317 4.3698a19.7913 19.7913 0 0 0-4.8851-1.5152.0741.0741 0 0 0-.0785.0371c-.211.375-.4447.8648-.6083 1.2495-1.8447-.2762-3.6804-.2762-5.4868 0-.1636-.3933-.4058-.8745-.6177-1.2495a.077.077 0 0 0-.0785-.037 19.7363 19.7363 0 0 0-4.8852 1.515.0699.0699 0 0 0-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 0 0 .0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 0 0 .0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 0 0-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 0 1-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 0 1 .0776-.0105c3.9279 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 0 1 .0785.0095c.1202.099.246.198.3728.2924a.077.077 0 0 1-.0066.1276 12.2986 12.2986 0 0 1-1.873.8914.0766.0766 0 0 0-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 0 0 .0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 0 0 .0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 0 0-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9565-2.4189 2.157-2.4189 1.2108 0 2.175.1 2.1569 2.4188 0 1.3333-.9565 2.4191-2.157 2.4191zm7.9748 0c-1.183 0-2.157-1.0857-2.157-2.419 0-1.3332.957-2.4189 2.157-2.4189 1.2108 0 2.175.1 2.157 2.4188 0 1.3333-.9462 2.4191-2.157 2.4191Z" />
            </svg>
          </a>

          <a class="footer-link" href="https://buymeacoffee.com/xmacj" target="_blank" rel="noopener"
            aria-label="Buy me a coffee">
            <img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="" width="18" height="18"
              loading="lazy" />
          </a>
        </div>
      </div>
      <div id="update-notice">
        New Update Available
      </div>
    </footer>

    <script type="module" src="{{ request.url_for('static', path='assets/main.js') }}?v={{ version }}"></script>

</body>

</html>