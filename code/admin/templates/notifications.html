<!doctype html>
<html lang="en" class="boot">

<head>
    <meta charset="utf-8" />
    <title>Copycord – Message Notifications</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ request.url_for('static', path='assets/main.css') }}?v={{ version }}">
    <link rel="icon" type="image/png" href="/static/logo.png">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>

<body>
    <header class="site-header" role="banner">
        <button id="menu-toggle" class="menu-btn" aria-haspopup="true" aria-expanded="false" aria-controls="side-menu"
            aria-label="Open menu">
            <span class="bar"></span><span class="bar"></span><span class="bar"></span>
        </button>

        <a class="header-left header-home" href="/" aria-label="">
            <img src="/static/logo.png" alt="" aria-hidden="true" class="header-logo" draggable="false" />
            <h1>Copycord</h1>
        </a>
    </header>

    <div id="menu-backdrop" class="menu-backdrop" hidden></div>

    <aside id="side-menu" class="side-menu" aria-hidden="true" aria-label="Site menu">
        <nav class="side-menu-body">
            <ul class="menu-list">
                <li>
                    <a class="menu-item" href="/" rel="noopener">
                        <span class="mi" aria-hidden="true">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="1.5" aria-hidden="true" focusable="false">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                            </svg>
                        </span>
                        <span class="mi-label">Configuration</span>
                    </a>
                </li>

                <li>
                    <a class="menu-item" href="/channels" rel="noopener">
                        <span class="mi" aria-hidden="true">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="1.5" aria-hidden="true" focusable="false">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M5.25 8.25h15m-16.5 7.5h15m-1.8-13.5-3.9 19.5m-2.1-19.5-3.9 19.5" />
                            </svg>
                        </span>
                        <span class="mi-label">Channels</span>
                    </a>
                </li>

                <li>
                    <a class="menu-item" href="/guilds" rel="noopener">
                        <span class="mi" aria-hidden="true">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="1.5" aria-hidden="true" focusable="false">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                            </svg>
                        </span>
                        <span class="mi-label">Guilds</span>
                    </a>
                </li>

                <li>
                    <a class="menu-item is-active" href="/notifications" rel="noopener">
                        <span class="mi" aria-hidden="true">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="1.5" aria-hidden="true" focusable="false">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                            </svg>
                        </span>
                        <span class="mi-label">Notifications</span>
                    </a>
                </li>

                <li>
                    <a class="menu-item" href="/system" rel="noopener">
                        <span class="mi" aria-hidden="true">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="1.5" aria-hidden="true" focusable="false">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="m6.75 7.5 3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0 0 21 18V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v12a2.25 2.25 0 0 0 2.25 2.25Z" />
                            </svg>
                        </span>
                        <span class="mi-label">System</span>
                    </a>
                </li>
            </ul>
        </nav>

        <footer class="side-menu-footer" role="contentinfo" aria-label="About">
            <a class="sm-footer-link" href="{{ links.github }}" target="_blank" rel="noopener" aria-label="Open GitHub">
                <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                    <path
                        d="M12 .3A12 12 0 0 0 8.21 23.7c.6.11.79-.26.79-.58v-2.07c-3.34.73-4.04-1.61-4.04-1.61a3.18 3.18 0 0 0-1.34-1.76c-1.1-.75.09-.74.09-.74a2.52 2.52 0 0 1 1.84 1.24 2.56 2.56 0 0 0 3.49 1 2.54 2.54 0 0 1 .76-1.6c-2.67-.3-5.47-1.34-5.47-5.93a4.65 4.65 0 0 1 1.24-3.23 4.3 4.3 0 0 1 .12-3.18s1-.32 3.3 1.23a11.38 11.38 0 0 1 6 0c2.3-1.55 3.29-1.23 3.29-1.23a4.3 4.3 0 0 1 .12 3.18 4.65 4.65 0 0 1 1.24 3.23c0 4.6-2.8 5.63-5.48 5.93a2.87 2.87 0 0 1 .82 2.23v3.3c0 .32.2.69.8.58A12 12 0 0 0 12 .3z" />
                </svg>
                <span>GitHub</span>
            </a>
            <span class="sm-version">{% if version %}{{ version }}{% else %}dev{% endif %}</span>
        </footer>
    </aside>

    <div class="container">
        <!-- Root for notifications page -->
        <div id="notif-root" class="notifications-page">
            <section class="card">
                <header class="card-header">
                    <h2>Notification Rules</h2>
                    <p class="card-subtitle">
                        Watch for specific words, phrases, or channels in messages and send alerts to
                        Pushover, webhooks, or Telegram.
                    </p>
                </header>

                <div class="card-body">
                    <!-- Primary action -->
                    <div class="notif-scope-row">
                        <div class="form-actions">
                            <button id="notifCreateBtn" class="btn btn-ghost" type="button">
                                + New Notification
                            </button>
                        </div>
                    </div>

                    <!-- Empty state + list, all in the same card -->
                    <div id="notification-empty" class="empty-state" hidden>
                        <p>No notification rules yet.</p>
                    </div>

                    <div id="notification-list" class="notif-list"></div>
                </div>
            </section>
        </div>

        <!-- Modal lives at root so it's not clipped by cards -->
        <div id="notifModal" class="modal" aria-hidden="true">
            <div class="modal-backdrop"></div>

            <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="notifModalTitle">
                <div class="modal-header">
                    <h3 class="modal-title" id="notifModalTitle">New Notification</h3>
                    <button class="icon-btn verify-close" id="notifModalCloseBtn" type="button" aria-label="Close">✕</button>
                </div>

                <div class="modal-body">
                    <form id="notification-form" autocomplete="off">
                        <input type="hidden" id="notif_id" name="notif_id" value="" />

                        <div class="form-group">
                            <label for="notif_label" class="form-label">Name</label>
                            <input id="notif_label" name="label" class="input" type="text"
                                placeholder="e.g. Pushover: #support keyword alerts" required />
                            <p class="help-text">
                                A short name so you can recognize this rule later.
                            </p>
                        </div>

                        <div class="form-group">
                            <label for="notif_guild_id" class="form-label">Guild scope</label>
                            <select id="notif_guild_id" name="guild_id" class="input">
                                <option value="">All guilds</option>
                                <!-- options are populated by notifications.js via /api/guilds -->
                            </select>
                            <p class="help-text">
                                If set, this rule only applies to messages from the selected guild.
                            </p>
                        </div>

                        <div class="form-group">
                            <label for="notif_provider" class="form-label">Provider</label>
                            <select id="notif_provider" name="provider" class="input" required>
                                <option value="">Choose provider…</option>
                                <option value="pushover">Pushover</option>
                                <option value="webhook">Generic webhook</option>
                                <option value="telegram">Telegram</option>
                            </select>
                            <p class="help-text">
                                Choose where Copycord should send alerts when this rule matches.
                            </p>
                        </div>

                        <!-- Provider-specific fields -->
                        <div id="provider_pushover" class="provider-fields" hidden>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="pushover_app_token">App token</label>
                                    <input id="pushover_app_token" class="input" type="text" autocomplete="off"
                                        placeholder="Pushover application token" />
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="pushover_user_key">User / group key</label>
                                    <input id="pushover_user_key" class="input" type="text" autocomplete="off"
                                        placeholder="User or group key" />
                                </div>
                            </div>
                        </div>

                        <div id="provider_webhook" class="provider-fields" hidden>
                            <div class="form-group">
                                <label class="form-label" for="webhook_url">Webhook URL</label>
                                <input id="webhook_url" class="input" type="url" autocomplete="off"
                                    placeholder="https://example.com/webhook" />
                                <p class="help-text">
                                    Copycord will POST a JSON payload whenever this rule fires.
                                </p>
                            </div>
                        </div>

                        <div id="provider_telegram" class="provider-fields" hidden>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="telegram_bot_token">Bot token</label>
                                    <input id="telegram_bot_token" class="input" type="text" autocomplete="off"
                                        placeholder="123456:ABC-DEF..." />
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="telegram_chat_id">Chat ID</label>
                                    <input id="telegram_chat_id" class="input" type="text" autocomplete="off"
                                        placeholder="Chat or channel ID" />
                                </div>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="form-group">
                            <label class="form-label" for="notif_keywords_any">Match any of these words /
                                phrases</label>
                            <input id="notif_keywords_any" class="input" type="text"
                                placeholder="Comma separated (e.g. support, outage, urgent)" />
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="notif_keywords_all">Require all of these words
                                (optional)</label>
                            <input id="notif_keywords_all" class="input" type="text"
                                placeholder="Comma separated (e.g. payment, failed)" />
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="notif_channels">Limit to channel IDs (optional)</label>
                                <input id="notif_channels" class="input" type="text"
                                    placeholder="Comma separated channel IDs, or empty for all channels" />
                            </div>
                            <div class="form-group">
                                <label class="checkbox-inline">
                                    <input id="notif_case_sensitive" type="checkbox" />
                                    <span>Case sensitive</span>
                                </label>
                                <label class="checkbox-inline">
                                    <input id="notif_include_embeds" type="checkbox" />
                                    <span>Search text in embeds</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="checkbox-inline">
                                    <input id="notif_enabled" type="checkbox" checked />
                                    <span>Rule enabled</span>
                                </label>
                            </div>
                            <div class="form-group form-actions">
                                <button id="notifCancelBtn" type="button" class="btn btn-ghost">
                                    Cancel
                                </button>
                                <button id="notifSaveBtn" type="submit" class="btn btn-primary">
                                    Save Rule
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="true"></div>

        <footer id="fixed-footer" role="contentinfo" aria-label="Site footer">
            <div class="footer-bar">
                <span class="footer-brand" aria-label="Copycord version {{ version or 'dev' }}">
                    <span class="brand-name">Copycord</span>
                    <span class="brand-sep" aria-hidden="true"></span>
                    <bdi class="brand-version" id="footer-version">
                        {% if version %}
                        <a id="footer-version-link" href="{{ links.github }}/releases/tag/{{ version }}" target="_blank"
                            rel="noopener" class="footer-link"
                            data-default-href="{{ links.github }}/releases/tag/{{ version }}">
                            {{ version }}
                        </a>
                        {% else %}
                        <span id="footer-version-text">dev</span>
                        {% endif %}
                    </bdi>
                </span>

                <div class="footer-links" role="group" aria-label="Links">
                    <a class="footer-link" href="{{ links.github }}" target="_blank" rel="noopener" aria-label="GitHub">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path
                                d="M12,2A10,10 0 0,0 2,12c0,4.42 2.87,8.16 6.84,9.49.5.09.68-.22.68-.48 0-.24-.01-.87-.01-1.71-2.78.6-3.37-1.34-3.37-1.34-.45-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.61.07-.61 1.01.07 1.54 1.04 1.54 1.04.9 1.53 2.36 1.09 2.94.83.09-.65.35-1.09.63-1.34-2.22-.25-4.56-1.11-4.56-4.95 0-1.09.39-1.98 1.03-2.68-.1-.25-.45-1.27.1-2.65 0 0 .84-.27 2.75 1.02A9.56 9.56 0 0 1 12 6.8c.85 0 1.71.11 2.51.33 1.9-1.29 2.74-1.02 2.74-1.02.55 1.38.2 2.4.1 2.65.64.7 1.03 1.59 1.03 2.68 0 3.85-2.34 4.7-4.57 4.95.36.31.68.92.68 1.85 0 1.34-.01 2.42-.01 2.75 0 .26.18.58.69.48A10 10 0 0 0 22 12 10 10 0 0 0 12 2Z" />
                        </svg>
                    </a>

                    <a class="footer-link" href="{{ links.discord }}" target="_blank" rel="noopener"
                        aria-label="Join our Discord">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="20" height="20">
                            <path
                                d="M20.317 4.3698a19.7913 19.7913 0 0 0-4.8851-1.5152.0741.0741 0 0 0-.0785.0371c-.211.375-.4447.8648-.6083 1.2495-1.8447-.2762-3.6804-.2762-5.4868 0-.1636-.3933-.4058-.8745-.6177-1.2495a.077.077 0 0 0-.0785-.037 19.7363 19.7363 0 0 0-4.8852 1.515.0699.0699 0 0 0-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 0 0 .0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 0 0 .0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 0 0-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 0 1-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 0 1 .0776-.0105c3.9279 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 0 1 .0785.0095c.1202.099.246.198.3728.2924a.077.077 0 0 1-.0066.1276 12.2986 12.2986 0 0 1-1.873.8914.0766.0766 0 0 0-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 0 0 .0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 0 0 .0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 0 0-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9565-2.4189 2.157-2.4189 1.2108 0 2.175.1 2.1569 2.4188 0 1.3333-.9565 2.4191-2.157 2.4191zm7.9748 0c-1.183 0-2.157-1.0857-2.157-2.419 0-1.3332.957-2.4189 2.157-2.4189 1.2108 0 2.175.1 2.157 2.4188 0 1.3333-.9462 2.4191-2.157 2.4191Z" />
                        </svg>
                    </a>

                    <a class="footer-link" href="{{ links.kofi }}" target="_blank" rel="noopener"
                        aria-label="Buy me a coffee">
                        <img src="https://storage.ko-fi.com/cdn/brandasset/v2/kofi_symbol.png" alt="" width="18"
                            height="18" loading="lazy" />
                    </a>
                </div>
            </div>
            <div id="update-notice">
                New Update Available
            </div>
        </footer>
    </div>

    <script type="module" src="{{ request.url_for('static', path='assets/main.js') }}?v={{ version }}"></script>
</body>

</html>
